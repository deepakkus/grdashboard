{"ast":null,"code":"import _regeneratorRuntime from\"/Users/manish/Desktop/sensegrass/banao_lg/sensegrass/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/manish/Desktop/sensegrass/banao_lg/sensegrass/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/manish/Desktop/sensegrass/banao_lg/sensegrass/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/manish/Desktop/sensegrass/banao_lg/sensegrass/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/manish/Desktop/sensegrass/banao_lg/sensegrass/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import\"./AddDevice.scss\";import{Button,Form,Grid,Header}from\"semantic-ui-react\";import{MuiThemeProvider,createMuiTheme}from\"@material-ui/core/styles\";import addDeviceImg from\"../../../images/addDevice.png\";import{AiOutlinePlus}from\"react-icons/ai\";import{useTranslation}from\"react-i18next\";import TextField from\"@material-ui/core/TextField\";// import Input from \"../common/Input\";\nimport Logo from\"../../common/Logo\";import AlertBar from\"../../AlertBar/AlertBar\";import{updateUserFarmDevice}from\"../../../services/farm\";var theme=createMuiTheme({palette:{primary:{light:\"#fff\",main:\"#67bc46\",dark:\"#000\"},secondary:{main:\"#fff\"}},typography:{useNextVariants:true}});var AddDevice=function AddDevice(props){var _useTranslation=useTranslation(\"add-device\"),t=_useTranslation.t;// console.log(props);\nvar saveDevice=props.saveDevice;var _useState=useState({deviceID:\"\",validationMsg:false,isOpen:false,msg:\"\",verticalInput:\"\",horizontalInput:\"\",severity:\"\",errMsg:\"\"}),_useState2=_slicedToArray(_useState,2),values=_useState2[0],setValues=_useState2[1];console.log({values:values});var emailLabel=React.createRef();//  ^[0-9]+$    \nvar handleChange=function handleChange(name,value){//if(/^[0-9]+$|^$/.test(value)){\n//  setValues({...values, validationMsg: false, [name]: value});\n//}\nsetValues(_objectSpread(_objectSpread({},values),{},_defineProperty({},name,value)));};var handleBack=function handleBack(){props.history.push(\"/\"+props.history.location.search);};var _props$devices=props.devices,userDevices=_props$devices.userDevices,error=_props$devices.error;// let errorMsg = error.data ? error.data.message : \"\";\n// console.log({ errorMsg });\nvar handleNext=function handleNext(){props.history.push(\"/sensors/\".concat(values.deviceID?values.deviceID:\"\")// `/sensors/${userDevices.length ? userDevices[0].deviceId : \"\"}`\n);};var handleEmailFocus=function handleEmailFocus(e){return emailLabel.current.innerText=t(\"place-holder\");};var handleEmailBlur=function handleEmailBlur(e){return emailLabel.current.innerText=\"\";};var saveHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var deviceID,validationMsg,deviceType,deviceTypeId,deviceId,userId,deviceName,device,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:deviceID=values.deviceID,validationMsg=values.validationMsg;// TODO for now it is only soil sensor\ndeviceType=props.devicetypes.find(function(d){return d.name===\"Soil Sensor\";});deviceTypeId=deviceType._id;deviceId=values.deviceID;userId=props.userId;deviceName=\"\".concat(deviceType.name,\" \").concat(userDevices.length+1);device={deviceTypeId:deviceTypeId,deviceId:deviceId,userId:userId,deviceName:deviceName};_context.next=9;return saveDevice(device,props.token);case 9:res=_context.sent;updateUserFarmDevice(userId);console.log({res:res});if(res==undefined&&!res.data){setValues(_objectSpread(_objectSpread({},values),{},{validationMsg:true,isOpen:true,msg:t(\"network-error-msg\"),severity:\"error\"}));setTimeout(function(){setValues(_objectSpread(_objectSpread({},values),{},{validationMsg:true,isOpen:false,msg:t(\"network-error-msg\"),severity:\"error\"}));},3001);}else if(!res.data){setValues(_objectSpread(_objectSpread({},values),{},{validationMsg:false,isOpen:true,msg:t(\"success-msg\"),severity:\"success\"}));setTimeout(function(){setValues(_objectSpread(_objectSpread({},values),{},{validationMsg:\"\",isOpen:false,msg:t(\"success-msg\"),severity:\"success\"}));},3001);}else if(res.data.message===\"Device ID is already added\"){setValues(_objectSpread(_objectSpread({},values),{},{validationMsg:true,isOpen:true,msg:t(\"error-msg-added-already\"),severity:\"error\"}));setTimeout(function(){setValues(_objectSpread(_objectSpread({},values),{},{validationMsg:true,isOpen:false,msg:t(\"error-msg-added-already\"),severity:\"error\"}));},3001);}else{setValues(_objectSpread(_objectSpread({},values),{},{validationMsg:true,isOpen:true,msg:t(\"error-msg\"),severity:\"error\"}));setTimeout(function(){setValues(_objectSpread(_objectSpread({},values),{},{validationMsg:true,isOpen:false,msg:t(\"error-msg\"),severity:\"error\"}));},3001);}case 13:case\"end\":return _context.stop();}}},_callee);}));return function saveHandler(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(MuiThemeProvider,{theme:theme},/*#__PURE__*/React.createElement(\"div\",{className:\"device-container addDeviceContainer\"},/*#__PURE__*/React.createElement(Grid,{className:\"left-col\"},/*#__PURE__*/React.createElement(Grid.Column,null,/*#__PURE__*/React.createElement(Logo,null),/*#__PURE__*/React.createElement(Grid,{textAlign:\"center\",style:{marginTop:\"6rem\"},verticalAlign:\"middle\",className:\"padit\"},/*#__PURE__*/React.createElement(Grid.Column,{style:{maxWidth:350}},/*#__PURE__*/React.createElement(Header,{as:\"h3\",color:\"grey\",textAlign:\"left\"},t(\"enter-sensor\")),/*#__PURE__*/React.createElement(\"img\",{src:addDeviceImg,alt:\"addDevice\",className:\"addDeviceImg\"}),/*#__PURE__*/React.createElement(Form,{size:\"large\"},/*#__PURE__*/React.createElement(\"div\",{class:\"buttonInside\"},/*#__PURE__*/React.createElement(TextField,{id:\"outlined-multiline-flexible\",label:t(\"device-id\"),variant:\"outlined\",onFocus:handleEmailFocus,onBlur:handleEmailBlur,fullWidth:true,placeholder:\"14253614\",name:\"deviceID\",value:values.deviceID,onChange:function onChange(e){return handleChange(e.target.name,e.target.value);},autoComplete:\"off\",error:values.validationMsg,helperText:values.validationMsg?// t(\"plaese enter differnt device-id\")\nt(\"validation-msg\"):\"Find Device ID on Box  or below QR code on your Device \"}),/*#__PURE__*/React.createElement(\"p\",{ref:emailLabel,className:\"label\"})),/*#__PURE__*/React.createElement(Grid.Row,{style:{display:\"flex\",justifyContent:\"space-between\",width:\"100%\",marginTop:\"1rem  \"}},/*#__PURE__*/React.createElement(Grid.Column,null,/*#__PURE__*/React.createElement(Button,{fluid:true,size:\"large\",className:\"white\",onClick:handleBack},t(\"back\"))),/*#__PURE__*/React.createElement(Grid.Column,null,/*#__PURE__*/React.createElement(Button,{color:\"green\",fluid:true,size:\"large\",className:\"pr-3  pl-3\",onClick:function onClick(){saveHandler();},style:{display:\"flex\",justifyContent:\"space-between\"}},/*#__PURE__*/React.createElement(AiOutlinePlus,{style:{color:\"white\",fontSize:\"1.rem\"}}),t(\"add-device\"))),/*#__PURE__*/React.createElement(Grid.Column,null,/*#__PURE__*/React.createElement(Button,{fluid:true,size:\"large\",className:\"white\",onClick:handleNext},t(\"next\"))),/*#__PURE__*/React.createElement(Grid.Column,null,/*#__PURE__*/React.createElement(AlertBar,{isOpen:values.isOpen// isOpen={true}\n,msg:values.msg,verticalInput:\"top\",horizontalInput:\"left\",severity:values.severity// errorMsg={errorMsg}\n})))))))),/*#__PURE__*/React.createElement(Grid,{className:\"right-col\"},/*#__PURE__*/React.createElement(Grid.Column,null,/*#__PURE__*/React.createElement(\"div\",{className:\"imagesection\"})))));};export default AddDevice;","map":{"version":3,"sources":["/Users/manish/Desktop/sensegrass/banao_lg/sensegrass/src/components/Page/AddDevice/AddDevice.js"],"names":["React","useState","useEffect","Button","Form","Grid","Header","MuiThemeProvider","createMuiTheme","addDeviceImg","AiOutlinePlus","useTranslation","TextField","Logo","AlertBar","updateUserFarmDevice","theme","palette","primary","light","main","dark","secondary","typography","useNextVariants","AddDevice","props","t","saveDevice","deviceID","validationMsg","isOpen","msg","verticalInput","horizontalInput","severity","errMsg","values","setValues","console","log","emailLabel","createRef","handleChange","name","value","handleBack","history","push","location","search","devices","userDevices","error","handleNext","handleEmailFocus","e","current","innerText","handleEmailBlur","saveHandler","deviceType","devicetypes","find","d","deviceTypeId","_id","deviceId","userId","deviceName","length","device","token","res","undefined","data","setTimeout","message","marginTop","maxWidth","target","display","justifyContent","width","color","fontSize"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport \"./AddDevice.scss\";\nimport { Button, Form, Grid, Header } from \"semantic-ui-react\";\nimport { MuiThemeProvider, createMuiTheme } from \"@material-ui/core/styles\";\nimport addDeviceImg from \"../../../images/addDevice.png\";\nimport { AiOutlinePlus } from \"react-icons/ai\";\nimport { useTranslation } from \"react-i18next\";\nimport TextField from \"@material-ui/core/TextField\";\n// import Input from \"../common/Input\";\nimport Logo from \"../../common/Logo\";\nimport AlertBar from \"../../AlertBar/AlertBar\";\nimport { updateUserFarmDevice } from \"../../../services/farm\";\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: {\n      light: \"#fff\",\n      main: \"#67bc46\",\n      dark: \"#000\",\n    },\n    secondary: {\n      main: \"#fff\",\n    },\n  },\n  typography: {\n    useNextVariants: true,\n  },\n});\n\nconst AddDevice = (props) => {\n  const { t } = useTranslation(\"add-device\");\n  // console.log(props);\n  const { saveDevice } = props;\n  const [values, setValues] = useState({\n    deviceID: \"\",\n    validationMsg: false,\n    isOpen: false,\n    msg: \"\",\n    verticalInput: \"\",\n    horizontalInput: \"\",\n    severity: \"\",\n    errMsg: \"\",\n  });\n  console.log({ values });\n\n  const emailLabel = React.createRef();\n  //  ^[0-9]+$    \n  const handleChange = (name, value) => {\n    //if(/^[0-9]+$|^$/.test(value)){\n    //  setValues({...values, validationMsg: false, [name]: value});\n    //}\n    setValues({ ...values, [name]: value });\n  };\n\n  const handleBack = () => {\n    props.history.push(\"/\" + props.history.location.search);\n  };\n\n  let { userDevices, error } = props.devices;\n  // let errorMsg = error.data ? error.data.message : \"\";\n\n  // console.log({ errorMsg });\n\n  const handleNext = () => {\n    props.history.push(\n      `/sensors/${values.deviceID ? values.deviceID : \"\"}`\n      // `/sensors/${userDevices.length ? userDevices[0].deviceId : \"\"}`\n    );\n  };\n\n  const handleEmailFocus = (e) =>\n    (emailLabel.current.innerText = t(\"place-holder\"));\n\n  const handleEmailBlur = (e) => (emailLabel.current.innerText = \"\");\n\n  const saveHandler = async () => {\n    const { deviceID, validationMsg } = values;\n\n    // TODO for now it is only soil sensor\n    const deviceType = props.devicetypes.find((d) => d.name === \"Soil Sensor\");\n    const deviceTypeId = deviceType._id;\n    const deviceId = values.deviceID;\n    const userId = props.userId;\n    const deviceName = `${deviceType.name} ${userDevices.length + 1}`;\n    const device = {\n      deviceTypeId,\n      deviceId,\n      userId,\n      deviceName,\n    };\n\n    let res = await saveDevice(device, props.token);\n    updateUserFarmDevice(userId);\n    console.log({ res });\n    if (res == undefined && !res.data) {\n      setValues({\n        ...values,\n        validationMsg: true,\n        isOpen: true,\n        msg: t(\"network-error-msg\"),\n        severity: \"error\",\n      });\n      setTimeout(() => {\n        setValues({\n          ...values,\n          validationMsg: true,\n          isOpen: false,\n          msg: t(\"network-error-msg\"),\n          severity: \"error\",\n        });\n      }, 3001);\n    } else if (!res.data) {\n      setValues({\n        ...values,\n        validationMsg: false,\n        isOpen: true,\n        msg: t(\"success-msg\"),\n        severity: \"success\",\n      });\n      setTimeout(() => {\n        setValues({\n          ...values,\n          validationMsg: \"\",\n          isOpen: false,\n          msg: t(\"success-msg\"),\n          severity: \"success\",\n        });\n      }, 3001);\n    } else if (res.data.message === \"Device ID is already added\") {\n      setValues({\n        ...values,\n        validationMsg: true,\n        isOpen: true,\n        msg: t(\"error-msg-added-already\"),\n        severity: \"error\",\n      });\n      setTimeout(() => {\n        setValues({\n          ...values,\n          validationMsg: true,\n          isOpen: false,\n          msg: t(\"error-msg-added-already\"),\n          severity: \"error\",\n        });\n      }, 3001);\n    } else {\n      setValues({\n        ...values,\n        validationMsg: true,\n        isOpen: true,\n        msg: t(\"error-msg\"),\n        severity: \"error\",\n      });\n      setTimeout(() => {\n        setValues({\n          ...values,\n          validationMsg: true,\n          isOpen: false,\n          msg: t(\"error-msg\"),\n          severity: \"error\",\n        });\n      }, 3001);\n    }\n  };\n\n  return (\n    <MuiThemeProvider theme={theme}>\n      <div className=\"device-container addDeviceContainer\">\n        <Grid className=\"left-col\">\n          <Grid.Column>\n            <Logo />\n            <Grid\n              textAlign=\"center\"\n              style={{ marginTop: \"6rem\" }}\n              verticalAlign=\"middle\"\n              className=\"padit\"\n            >\n              <Grid.Column style={{ maxWidth: 350 }}>\n                <Header as=\"h3\" color=\"grey\" textAlign=\"left\">\n                  {t(\"enter-sensor\")}\n                </Header>\n                <img\n                  src={addDeviceImg}\n                  alt=\"addDevice\"\n                  className=\"addDeviceImg\"\n                />\n                <Form size=\"large\">\n                  <div class=\"buttonInside\">\n                    <TextField\n                      id=\"outlined-multiline-flexible\"\n                      label={t(\"device-id\")}\n                      variant=\"outlined\"\n                      onFocus={handleEmailFocus}\n                      onBlur={handleEmailBlur}\n                      fullWidth\n                      placeholder=\"14253614\"\n                      name=\"deviceID\"\n                      value={values.deviceID}\n                      onChange={(e) =>\n                        handleChange(e.target.name, e.target.value)\n                      }\n                      autoComplete=\"off\"\n                      error={values.validationMsg}\n                      helperText={\n                        values.validationMsg\n                          ? // t(\"plaese enter differnt device-id\")\n                            t(\"validation-msg\")\n                          : \"Find Device ID on Box  or below QR code on your Device \"\n                      }\n                    />\n                    <p ref={emailLabel} className=\"label\"></p>\n                  </div>\n                  <Grid.Row\n                    style={{\n                      display: \"flex\",\n                      justifyContent: \"space-between\",\n                      width: \"100%\",\n                      marginTop: \"1rem  \",\n                    }}\n                  >\n                    <Grid.Column>\n                      <Button\n                        fluid\n                        size=\"large\"\n                        className=\"white\"\n                        onClick={handleBack}\n                      >\n                        {t(\"back\")}\n                      </Button>\n                    </Grid.Column>\n\n                    <Grid.Column>\n                      <Button\n                        color=\"green\"\n                        fluid\n                        size=\"large\"\n                        className=\"pr-3  pl-3\"\n                        onClick={() => {\n                          saveHandler();\n                        }}\n                        style={{\n                          display: \"flex\",\n                          justifyContent: \"space-between\",\n                        }}\n                      >\n                        <AiOutlinePlus\n                          style={{\n                            color: \"white\",\n                            fontSize: \"1.rem\",\n                          }}\n                        />\n\n                        {t(\"add-device\")}\n                      </Button>\n                    </Grid.Column>\n                    <Grid.Column>\n                      <Button\n                        fluid\n                        size=\"large\"\n                        className=\"white\"\n                        onClick={handleNext}\n                      >\n                        {t(\"next\")}\n                      </Button>\n                    </Grid.Column>\n                    <Grid.Column>\n                      <AlertBar\n                        isOpen={values.isOpen}\n                        // isOpen={true}\n                        msg={values.msg}\n                        verticalInput=\"top\"\n                        horizontalInput=\"left\"\n                        severity={values.severity}\n                        // errorMsg={errorMsg}\n                      />\n                    </Grid.Column>\n                  </Grid.Row>\n                </Form>\n              </Grid.Column>\n            </Grid>\n          </Grid.Column>\n        </Grid>\n        <Grid className=\"right-col\">\n          <Grid.Column>\n            <div className=\"imagesection\"></div>\n          </Grid.Column>\n        </Grid>\n      </div>\n    </MuiThemeProvider>\n  );\n};\n\nexport default AddDevice;\n"]},"metadata":{},"sourceType":"module"}